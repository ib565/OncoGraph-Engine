template_id: f3_3_therapies_target_a_not_b
family_id: F3.3
question: "Which drugs target {{ gene_symbol_include }} but not {{ gene_symbol_exclude }}?"
cypher: |
  MATCH (t:Therapy)-[r:TARGETS]->(gi:Gene)
  WHERE toLower(gi.symbol) = toLower('{{ gene_symbol_include }}')
     OR any(s IN coalesce(gi.synonyms, []) WHERE toLower(s) = toLower('{{ gene_symbol_include }}'))
  OPTIONAL MATCH (t)-[:TARGETS]->(gx:Gene)
  WHERE toLower(gx.symbol) = toLower('{{ gene_symbol_exclude }}')
     OR any(s IN coalesce(gx.synonyms, []) WHERE toLower(s) = toLower('{{ gene_symbol_exclude }}'))
  WITH t, r, gi, gx
  WHERE gx IS NULL
  RETURN
    gi.symbol AS gene_symbol,
    t.name AS therapy_name,
    r.moa AS targets_moa,
    coalesce(r.ref_sources, []) AS ref_sources,
    coalesce(r.ref_ids, []) AS ref_ids,
    coalesce(r.ref_urls, []) AS ref_urls
  LIMIT 100
placeholders:
  gene_symbol_include:
    from: civic.genes
    sample: canonical_only
  gene_symbol_exclude:
    from: civic.genes
    sample: canonical_only


